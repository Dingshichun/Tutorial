# Git 使用
## (1) 简介
git 和 SVN 都是版本控制器，版本控制器的类型有本地版本控制、集中版本控制(SVN)、分布式版本控制(git)。   
SVN 是集中式版本控制器，其版本库集中放在中央服务器上，所有用户都要从中央服务器上获取版本，完成后再推送到中央服务器。必须联网才能工作，要求较高的网络带宽。  
git 是分布式版本控制器，即所有的版本信息仓库全部同步到本地的每一个用户，这样就可以在本地查看所有版本历史，离线时也可以在本地提交，等到联网时再推送到服务器或其他用户即可。  
由于每个用户都有所有数据，所以只要一个用户的数据完好，就可以恢复所有数据，但是也增加了本地存储。不用担心服务器损坏或网络问题导致不能工作。
## (2) git 基本配置
### (2.1) 用户名和邮箱配置
安装完成后直接在电脑上搜索 git 打开，或者在桌面右击，查看更多选项，会有 git 图标。  
然后需要基本配置，比如必要的**用户名和邮箱**。使用 --global 配置用户名以后，系统将会默认使用该用户信息来处理系统中进行的所有操作，如果想在一个项目中使用不同的用户进行操作，则不加 --global 。
```
git config --global user.name "DSC" # 用户名，global 表示全局
git config --global user.email 2233429841@qq.com # 邮箱
```
使用 `git config -l` 查看所有配置。  
### (2.2) 对给 git 配置用户名和邮箱的理解
1. **为什么要配置用户名和邮箱？**
* 远程仓库一般支持两种协议：SSH 和 HTTPS，SSH 协议只认机器，HTTPS 协议只认账号；也即为：如果使用 SSH 操作远程仓库的话，我们需要使用公钥和私钥对来做权限的认证，如果使用 HTTPS 操作远程仓库，则需要使用账号密码来做权限的认证。  
无论是公钥私钥对，还是账号密码，都只做权限的认证。但是远程仓库里需要记录这些提交记录是由谁来完成的，所以我们需要给本地的 git 设置用户名和邮箱，用于从本地仓库向远程仓库提交记录时，在远程仓库记录下这些操作是由谁来完成的。
* 而且 git 是分布式版本控制系统，所以，每个机器都必须自报家门：你的用户名和 Email 地址（名字和邮箱都不会进行验证），这样远程仓库才知道哪次提交是由谁完成的。    
别人冒充也不必担心，因为有法可查。
2. **配置的用户名和邮箱对 push 代码到远程仓库有什么影响？**
* 首先，配置的用户名和邮箱对 push 代码到远程仓库时的身份验证没有作用，即不用他们进行身份验证；他们仅仅会出现在远程仓库的 commits 里。

* 其次，按正常操作来说，你应该配置你的真实用户名和邮箱，这样一来在远程仓库的 commits 里可以看到哪个操作是你所为。

* 最后，这个用户名和邮箱是可以随便配置的（不提倡），如果你配置的邮箱是 github 里真实存在的邮箱，则 commits 里显示的是这个邮箱对应的账号；如果配置的邮箱是一个在 github 里不存在的邮箱，则 commits 里显示的是你配置的用户名。
## (3) git 基本理论
git 本地有三个工作区域：工作目录(working directory)、暂存区(stage/index)、本地仓库(repository 或 git directory)    
working directory：即工作区，平时存放项目代码的地方  
stage/index:暂存区，暂时保存你的改动，只是一个文件，  
repository:本地仓库，安全存放数据的位置，有提交的所有版本数据，
remote repository:远程仓库，比如 GitHub、Gitee 

git 提交修改的顺序：工作区——>暂存区——>本地仓库——>远程仓库
**主要命令**:  
* git add: 将工作区修改的内容提交到暂存区，` git add .` 将所有修改的文件提交到暂存区  
也可以仅指定一些已修改的文件提交到暂存区，比如 : `git add hello.py` 。
* git commit: 将暂存区的内容提交到本地仓库，`-m` 选项表示 message ，即提交时的备注，  
比如 `git commit -m "this is the first upload"`
* git push: 将本地仓库的内容提交到远程仓库，需要先配置好远程仓库
* git pull: 从远程仓库拉取
* git reset: 撤销从暂存区提交到本地仓库的内容
* git chekout: 撤销从工作区提交到暂存区的内容

* git log: 查看提交历史
* git status: 查看工作区和暂存区的状态
* git diff: 查看文件在工作区、暂存区、版本库之间的差异，默认是查看工作区和暂存区的差异，`git diff HEAD` 则是查看暂存区和版本库之间的差异。还可以查看两个版本库之间的差异。
* git rm: 删除工作区文件，并且将这次删除记录放入暂存区。注意:要删除的文件是没有修改过的，就是说和当前版本库文件的内容相同。
* git rm -f : 删除工作区和暂存区文件，并且将这次删除记录放入暂存区。注意： 要删除的文件已经修改过，就是说和当前版本库文件的内容不同。
* git rm --cached : 删除暂存区文件，但保留工作区的文件，并且将这次删除记录放入暂存区。
* HEAD 选项表示最新版本库, HEAD~ 表示上一个版本库。
## (4) git 项目创建 
* **方法 1**: 在要创建 git 项目的文件夹打开 git ，使用 `git init` 初始化仓库，  
文件夹中就会生成一个 .git 文件夹，用于存放项目相关数据，是一个隐藏文件夹。
* **方法 2**: 直接使用 `git clone 远程项目地址` 将远程仓库中的项目克隆到本地，  
比如: `git clone https://github.com/Dingshichun/Pytorch.git` 

## (5) git 文件操作
**1、文件的四种状态**
* untracked : 此文件在文件夹中，但没有加入到 .git 库，不参与版本控制，通过 `git add` 将其状态变为 `staged`
* unmodify : 文件已经入库，但是未修改，即版本库中的文件快照内容和文件夹中的一致。  
这种文件如果被修改，状态就变为 `modified` , 如果使用 `git rm` 移出版本库，状态就变为 `untracked`
* modified : 文件内容已被修改，但仅仅只是修改，无其它操作。  
通过 `git add` 将其状态变为 `staged` , 使用 `git checkout` 则丢弃修改，返回 `unmodify` 状态。
* staged : 暂存状态。执行 `git commit` 则将修改同步到本地库中，这是工作空间中的文件和本地库中的文件一样，    
所以其状态变为 `unmodify` , 如果执行 `git reset` 取消暂存，那么文件状态变为 `modified` 。 

2、**忽略文件**  
不想把某些文件纳入版本控制中，比如数据库文件、临时文件、设计文件，  
可以在主目录下建立 ".gitignore" 文件，此文件有如下规则：
* 1、该文件中的空行或以 "#" 开头的行将会被忽略
* 2、可以使用 Linux 通配符。比如 : "*" 代表任意多个字符；"?" 代表一个字符；方括号 [abc] 代表可选字符范围；  
大括号 {string1,string2} 代表可选的字符串
* 3、名称前有感叹号 "!" , 表示例外规则，将不被忽略。比如 : !hello.py 表示不忽略该文件
* 4、名称前面有路径分隔符 "/" , 表示忽略的文件在此目录下，其子目录中的文件不忽略。  
比如 : /temp 表示要忽略的文件在 temp 文件夹中  
* 5、名称后面有路径分隔符 "/" , 表示忽略的文件在此目录的子目录中，而不是该目录。  
**忽略文件 .gitignore 示例**:
```
"#" 表示注释
# "hello world" # 以 # 开头的行会被忽略
*.txt       # 忽略所有 .txt 结尾的文件
!lib.txt    # lib.txt 除外，不忽略
/temp       # 忽略项目根目录下的 temp 文件，不包括其它目录的 temp 
build/      # 忽略 build 目录下的所有文件
doc/*.txt   # 忽略 doc/ 这一级目录中的所有 .txt 文件，比如 : doc/name.txt , 但不会忽略其它级别目录的文件，比如 : doc/server/name.txt  
```
## (6) Gitee(码云) 使用
GitHub 服务器在国外，有墙，有时候会很慢。国内推荐使用 Gitee 
1. 注册登录
2. 设置本机绑定 SSH(Secure Shell) 公钥，实现免密登录
* 首先使用 `ssh-keygen` 命令生成密钥(包括公钥和私钥)。进入 `c:\user\世兰丁\.ssh` 目录，右键找到 git 打开。当然，在哪里打开 git 使用 `ssh-keygen` 命令生成密钥都行，上面只是默认路径。  
然后在终端输入 `ssh-keygen -t rsa` ，其中 `-t` 代表指定生成密钥类型(rsa)，直接按 enter 即可。    
就会在目录中生成两个文件 : id_rsa、id_rsa.pub ，pub 文件是公钥，另一个是私钥。  
* 登录 Gitee ，找到设置中的 SSH 公钥，将 pub 文件中的内容复制到公钥的位置，给公钥取个标题，确认添加即可。  
* 然后验证是否添加成功，在 git 终端输入 `git -T git@gitee.com` ，初次添加会询问是否添加，输入 yes ，会显示添加成功。  
此时生成密钥的文件夹中可能还会生成 known_hosts 和 authorized_keys 文件，known_hosts 用于保存已认证的远程主机 ID ，authorized_keys 用于保存已授权的客户端公钥。  
添加 SSH 成功之后，不需要账号密码即可进行 clone 和 push 。
* 同理，生成的公钥也可以添加到 GitHub ，方法一样，只是验证是否添加成功时需要换个网站名，即输入 `git -T git@github.com` ，初次添加同样会询问。  
* 最后验证添加的 SSH 能否使用。找到 Gitee 上面远程仓库的 SSH 下载链接，随便一个文件夹中打开 git ，输入 `git clone SSH下载链接` ，比如 : `git clone git@gitee.com:Dingshichun/computer_vision.git` ，即可成功克隆 Gitee 上的 computer_vision 仓库到本地。  
操作 GitHub 上的仓库跟 Gitee 一样。
## (7) git 分支
git 仓库初始化后默认有一个主分支 main 或 master
branch(分支)就是字面上的意思，分支便于多人开发和版本的管理。
**git branch 的常用命令如下**:  
```
# git branch ，查看所有分支

# git branch 也可创建分支，格式 : git branch 分支名
git branch dsc

# 切换分支 : git checkout 要切换到的分支名
git checkout dsc

# 创建分支并切换到创建的分支 : git checkout -b 分支名
git checkout -b dsc

# 合并分支到当前分支 : git merge 要合并的分支名
git merge dsc

# 删除分支 : git branch -d 要删除的分支名
git branch -d dsc
```
**git 分支提交冲突**  
如果合并分支时多个分支上修改的内容有部分相同，就会起冲突，选择想保留的部分即可。
## (8) IDE 中使用 git
### (8.1) 简介 
很多 IDE 都集成了 git 的功能，比如 VSCode ，其操作和命令行的方式差不多，只是加上图形界面将功能可视化了，对新手更加友好。  
VSCode 使用图形界面可以实现所有 git 功能，当然也可以在 git-bash 终端使用命令行，需要进行配置(自行百度即可)，配置完成后，在新建终端时就可以选择 git-bash ，以命令行完成操作。  
### (8.2) 使用问题和解决办法
**使用问题**     
使用时发现，如果终端没有全屏， `git diff` 命令没有显示工作区和暂存区的所有差异，只显示了一部分，需要按 enter 才能逐渐显示全部差异，然后按 q 才能退出显示回到终端，感觉不方便。git branch、git log、git show 等命令也存在不能全部显示的问题。  
上述问题和 git 的 pager(分页器) 有关，git 在一些版本中默认使用的是 less 工具，不同的版本默认设置会有差异，这也就是造成我在 windows 下没有自动分页，而在 linux 下会打开新窗口进行分页的原因。   
git 的分页器可以通过 core.pager 来进行设置，它会被 git 命令行解释，影响分页器的变量有多个，他们起作用的顺序依次是 $GIT_PAGER 环境变量，core.pager 配置，$PAGER 环境变量，如果这些都没有设置，默认会选择编译时的选项(通常为 less)。 
**解决办法如下**：  
* 1、使用 `git --no-pager diff` 或 `git -P diff` 禁用分页即可全部输出，但是只对一次命令管用，仍然麻烦。
* 2、使用 `git config --global core.pager ''` 配置 git 全局选项。  
这行命令将 Git 的 core.pager 配置选项设置为空字符串，这将禁用分页功能，即执行 Git 命令时，输出将直接显示在终端窗口上，而不是分页显示。